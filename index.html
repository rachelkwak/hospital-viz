<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css' type='text/css' />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" />

<style>


#map { 
	position:relative; 
	width: 100%;
	height: 500px;
}

svg {
	position: absolute;
	width: 100%;
	height: 500px;
}

.hidden {
	display: none;
}

.show {
	display: ;
}

#usa {
	/*stroke: orange;*/
	/*fill: blue;*/
	fill-opacity: 0.5;
}

</style>

</head>

<body>

<nav class="navbar navbar-dark bg-dark justify-content-between">
  <a class="navbar-brand text-light">Hospital Vis</a>
  <form class="form-inline">
    <input class="form-control mr-sm-2" type="search" placeholder="Search Proceedures" aria-label="Search">
    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Select</button>
  </form>
</nav>
<br>
<br>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-7">
			<div id="map"></div> 
		</div>
		<div class="col-sm-5">
			<div class="card">
  				<table class="table">
  <thead>
    <tr>
      <th scope="col" id="hosName">[Hosptial Name]</th>
      <th scope="col">Ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row"><span id="procName">Proceedure</span> Average:</th>
      <td id="procPrice" class="text-success">$12345.00</td>
    </tr>
    <tr>
      <th scope="row">Overall Rating:</th>
      <td id="hosRating" class="text-warning">3.5</td>
    </tr>
    <tr>
      <th scope="row">Effectiveness of Care:</th>
      <td id="hosCare" class="text-success">Above Average</td>
    </tr>
    <tr>
      <th scope="row">Safety of Care:</th>
      <td id="hosSafety" class="text-success">Above Average</td>
    </tr>
    <tr>
      <th scope="row">Patient Experience:</th>
      <td id="hosExp" class="text-danger">Below Average</td>
    </tr>
  </tbody>
</table>
			</div>
		</div>
	</div>
</div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiY29ybmVsbHJwYWwiLCJhIjoiY2o1bHdqZ3JuMzk2MzMybzh3dGc5Ymo5eCJ9.GZetHX1kypdxcVVSbil7jw'

var maxBounds = new mapboxgl.LngLatBounds([-167.276413, 5.499550], [-52.233040, 83.162102]);

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v9',
    center: [-95.19670010050714, 38.04066455795754],
    zoom: 3.3381432488722704,
    maxBounds: maxBounds
});

map.addControl(new MapboxGeocoder({
    accessToken: mapboxgl.accessToken
}));

map.addControl(new mapboxgl.NavigationControl());

var zoomThreshold = 7;



map.on('load', function() {
	map.addSource('stateData', {
	type: 'geojson',
	data: './stateData.geojson'
});

    map.addLayer({
        'id': 'state-cov',
        'source': 'stateData',
        'type': 'fill',
        'maxzoom': zoomThreshold,
        'paint': {
            'fill-color': {
                property: 'avg_covered',
                // change colors
                stops: [
                    [0, '#F2F12D'],
                    [5000, '#EED322'],
                    [7500, '#E6B71E'],
                    [10000, '#DA9C20'],
                    [25000, '#CA8323'],
                    [50000, '#B86B25'],
                    [75000, '#A25626'],
                    [100000, '#8B4225'],
                    [250000, '#723122']
                ] 
            },
            'fill-opacity': 0.75
        }
    }, 'waterway-label');
});

map.on('load', function() {
	map.addSource('hospitals', {
	type: 'geojson',
	data: './hospitals_processed.geojson'
});

	map.addLayer({
	  id: 'points',
	  interactive: true,
	  type: 'circle',
	  source: 'hospitals',
	  minzoom: zoomThreshold,
	  paint: {
	    'circle-radius': {
	      	'base': 1.5,
            'stops': [[12, 2], [22, 100]]
	    	},

	    "circle-color": 'red',
	  	}

	}, 'waterway-label');
});









// var container = map.getCanvasContainer();
// var svg_map = d3.select(container).append("svg");
// var svg_data = d3.select(container).append("svg");

// var transform = d3.geoTransform({
//     point: projectPoint
// });
// var path = d3.geoPath().projection(transform);


// d3.json("us.json", function(err, data) {
// 	d3.json("state_cost.json", function(err, state_data) {
// 		d3.json("hospital.json", function(err, hospital) {
			
// 			hospital.forEach(function(d) {
// 				if (d.long&& d.lat){
// 					d.coord = new mapboxgl.LngLat(d.long, d.lat);
// 				}
//             });
// 			var color = d3.scaleLinear()
// 								.domain([18000, 97700])  
// 								.range(["white", "blue"]); 

// 		    var featureElement = svg_map.selectAll("path")
// 		        .data(topojson.feature(data, data.objects.states).features)
// 		        .enter()
// 		        .append("path")
// 		        .attr("d", path)
// 		        .attr("id", "usa")
// 		        .style("fill", function(d) {return color(state_data[d.properties.name]); });

// 		    var circles = svg_data.attr("id", "hospital").selectAll("circle").data(hospital);

// 		    map.on("viewreset", update)
// 		    map.on("movestart", function() {
// 		        svg_map.classed("hidden", true);
// 		        svg_data.classed("hidden", true);
// 		    });
// 		    map.on("moveend", function() {
// 		        update()
		        
// 		        if (map.getZoom() < 7) {
// 		            svg_map.classed("hidden", false);
// 		            svg_data.classed("hidden", true);
// 		        } else {
// 		        	svg_data.classed("hidden", false);
// 		        }
// 		    })

// 		    function update() {
// 		        featureElement.attr("d", path);

// 		        if (map.getZoom() >= 7) {
// 			        circles.enter().selectAll('circle').remove();

// 				    circles.enter()
// 		                    .append("circle")
// 		                    .attr("cx", function(d) {
// 		                        if (d.coord) {
// 		                        	var c = map.project(d.coord);
// 		                            return c['x'];
// 		                        }
// 		                    })
// 		                    .attr("cy", function(d) {
// 		                        if (d.coord) {
// 		                        	var c = map.project(d.coord);
// 		                            return c['y'];
// 		                        }
// 		                    })
// 		                    .attr("r", 4)
// 		                    .attr('fill-opacity', 0.4)
// 		                    .style("fill", "blue")
// 		        }

// 		    }

		    
// 		});
//     });
// });

// function projectPoint(lon, lat) {
//     var point = map.project(new mapboxgl.LngLat(lon, lat));
//     this.stream.point(point.x, point.y);
// }

</script>

</body>
</html>